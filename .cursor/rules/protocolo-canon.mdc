---
description: Bot√£o Protocolo ‚Äî l√≥gica cl√≠nica + estudo de casos + viabilidade financeira. N√£o substitui m√≥dulos; conecta e organiza. Projeto Sucesso.
globs:
  - **/protocolo*
  - **/planos*
  - **/plano*
  - PLANO-CANONICO.md
  - **/preco*.js
  - api/protocolo.js
---

# PROMPT ‚Äî BOT√ÉO PROTOCOLO
## (L√≥gica Cl√≠nica + Estudo de Casos + Viabilidade Financeira)
### Projeto Sucesso

## CONTEXTO DO SISTEMA

Este sistema j√° possui:

- Anamnese (com fun√ß√£o Pele)
- Procedimentos
- Planos
- Skincare
- Agenda
- Financeiro
- Estoque
- Copilot

O bot√£o Protocolo **n√£o substitui** nenhum desses m√≥dulos.
Ele **conecta e organiza**.

‚ö†Ô∏è **N√£o refatorar arquitetura existente.**

---

## DEFINI√á√ÉO OFICIAL

**Protocolo** = o que √© feito **dentro** do procedimento (m√©todo + registro do que foi aplicado) + prote√ß√£o da empresa +, no futuro, intelig√™ncia hist√≥rica e viabilidade financeira. Protocolo **n√£o √©** oferta, **n√£o √©** pre√ßo, **n√£o √©** promessa.

---

## PRINC√çPIO FUNDAMENTAL

**Protocolo organiza o cuidado.**
**Dados ajudam a escolher melhor.**
**Humanos decidem.**

---

## AS 3 DIMENS√ïES DO PROTOCOLO

1. **Cl√≠nica** ‚Äî como tratar
2. **Hist√≥rica** ‚Äî o que funcionou melhor
3. **Financeira** ‚Äî como sustentar sem perder margem

üìå Isso √© extremamente SaaS e extremamente raro em cl√≠nica.

---

## PROTOCOLO: PROTE√á√ÉO DA EMPRESA + ENTRADA F√ÅCIL

O protocolo √© uma forma de **prevenir a empresa** com **o que foi aplicado no paciente**. A entrada de dados tem que ser **f√°cil e r√°pida** ‚Äî n√£o ocupar tanto o tempo do profissional; n√£o ficar sem preencher (fluxo de atendimento j√° pode ser exaustivo). **Protocolo s√≥ cumpre o papel se for r√°pido de preencher.**

## ONDE O PROTOCOLO VIVE: ABA DO CLIENTE + ATALHO AGENDA + PROTOCOLOS DO DIA

- **Protocolo na aba do cliente:** registro do que foi aplicado fica **na aba do cliente**. Fluxo: agenda ‚Üí cliente ‚Üí aba do cliente ‚Üí preenche protocolo. N√£o √© fluxo separado e pesado.
- **Atalho da agenda (recomendado):** a partir do **atendimento na agenda**, abrir direto "Registrar o que foi aplicado" **sem** abrir o perfil inteiro do cliente. Agenda ‚Üí clica no atendimento ‚Üí registra protocolo (mais r√°pido).
- **Protocolos do dia:** vis√£o que cruza **todos os protocolos do dia** ‚Äî onde: **agenda** (filtro hoje + aba/resumo do dia) ou **dashboard** (bloco "Protocolos hoje"). Cruzar com estoque e hist√≥rico.

## ESTRUTURA DO PROTOCOLO

Um protocolo pode conter (o que √© feito **dentro** do procedimento):

- passos, produtos aplicados, t√©cnica
- **descart√°veis por protocolo** (o que cada protocolo usa de descart√°veis ‚Äî para o estoque assumir consumo quando o protocolo for aplicado)
- observa√ß√µes por procedimento
- registro por sess√£o/paciente: o que foi aplicado (formul√°rio r√°pido, poucos campos, sugest√µes a partir do protocolo)

## ESTOQUE V√ä PELO PROTOCOLO O QUE FOI USADO

- O **estoque** l√™ pelo protocolo o que foi usado em cada protocolo.
- **Assume descart√°veis:** ao registrar que o protocolo foi aplicado, o sistema **assume** que os descart√°veis cadastrados para aquele protocolo tamb√©m foram usados. Ajuda na an√°lise do estoque sem o profissional registrar item a item.
- **Hist√≥rico para acur√°cia (meta 85%):** acur√°cia = **previs√£o de consumo** (protocolo) vs **consumo real** (registrado/ajustado). Com o tempo, o hist√≥rico refina; meta = previs√£o **no m√≠nimo 85% acertiva**.
- **Alerta opcional:** ao registrar protocolo aplicado, o sistema pode **alertar** se descart√°vel daquele protocolo estiver em estoque baixo/zerado ‚Äî para repor ou ajustar, sem bloquear o registro.

---

## ESTUDO DE CASOS (INTELIG√äNCIA HIST√ìRICA)

O sistema deve permitir:

- associar **casos reais** aos protocolos
- **anonimizar** dados
- agrupar por:
  - tipo de pele
  - queixa principal
  - protocolo aplicado
  - resposta observada

A IA pode:

- identificar padr√µes
- sugerir quais protocolos costumam se adaptar melhor

A IA **n√£o pode**:

- garantir resultado
- criar promessa cl√≠nica
- substituir julgamento profissional

**Limite importante:** n√£o cria promessa, n√£o garante resultado, n√£o vira argumento cl√≠nico autom√°tico.  
üìå **IA explica tend√™ncia, n√£o define conduta.**

---

## RELA√á√ÉO COM ANAMNESE

O protocolo:

- **s√≥ pode ser aplicado ap√≥s anamnese**
- pode ser adaptado caso a caso
- **nunca** √© imposto automaticamente

---

## RELA√á√ÉO COM PLANOS

- **Plano** = conjunto de procedimentos + valores de venda (como apresentar ao cliente).
- **Protocolo** = o que √© feito **dentro** do procedimento + registro do que foi aplicado (prote√ß√£o da empresa). Dois bot√µes que se conversam.

---

## DIMENS√ÉO FINANCEIRA DO PROTOCOLO

O sistema deve permitir:

- calcular **custo m√©dio** do protocolo
- considerar:
  - tempo de agenda
  - consumo de estoque
  - custo operacional
- definir **margem planejada**

---

## SIMULA√á√ÉO DE DESCONTO E PAGAMENTO ‚Äî SEMPRE SIMULA√á√ÉO, NUNCA SUGEST√ÉO AUTOM√ÅTICA

Desconto e parcelamento s√£o **sempre simula√ß√£o**: o usu√°rio escolhe cen√°rios e v√™ o impacto. O sistema **nunca** sugere automaticamente ‚Äúd√™ X% de desconto‚Äù ou ‚Äúparcele em Y vezes‚Äù.

Permitir simula√ß√µes como:

- desconto √† vista (usu√°rio informa % e v√™ margem resultante)
- parcelamento em X vezes (usu√°rio informa vezes e v√™ impacto + taxas)
- impacto de taxas

Sempre mostrando:

- margem final
- limite seguro de desconto / parcelamento (quando o usu√°rio simula)

üìå **O sistema informa, n√£o decide. Simula√ß√£o = permitida; sugest√£o autom√°tica = proibida.**

Exemplo de leitura correta: *"At√© X parcelas mant√©m a margem m√≠nima."*  
Exemplo proibido: *"Recomendamos 5% de desconto √† vista."*

---

## VIABILIDADE (N√ÉO PROMO√á√ÉO)

O protocolo apoia **viabilidade** (margem, custo, simula√ß√£o). **N√£o** √© m√≥dulo de promo√ß√£o. O discurso do bot√£o Protocolo √© **m√©todo + hist√≥rico + viabilidade**, nunca ‚Äúpromo√ß√£o‚Äù.

O sistema pode:

- mostrar custo e margem
- permitir **simula√ß√£o** de desconto/parcelamento (usu√°rio testa cen√°rios)

O sistema **n√£o pode**:

- gerar promo√ß√µes ou ofertas automaticamente
- sugerir desconto ou parcelamento automaticamente (s√≥ simula√ß√£o, nunca sugest√£o)
- posicionar o m√≥dulo como ‚Äúpromo√ß√£o‚Äù ou ‚Äúvenda‚Äù

---

## PAPEL DO COPILOT

O Copilot pode:

- explicar dados
- resumir estudos de caso
- mostrar tend√™ncias
- alertar riscos financeiros

**Nunca**:

- criar protocolo cl√≠nico sozinho
- definir pre√ßo final
- substituir decis√£o humana

---

## CONTROLE DE PERMISS√ÉO

O bot√£o Protocolo:

- √© **t√©cnico**
- pode ser restrito a cargos espec√≠ficos
- n√£o precisa ser vis√≠vel para todos

---

## O QUE ESTE M√ìDULO N√ÉO FAZ

- N√£o vende
- N√£o promete
- N√£o diagnostica
- N√£o prescreve sozinho
- N√£o decide por humanos

**O bot√£o Protocolo n√£o vira:** m√≥dulo comercial puro, oferta autom√°tica, gerador de promo√ß√µes, promessa cl√≠nica.  
Tudo continua: **explic√°vel, audit√°vel, humano-validado.**

---

## FRASES-GUIA (N√ÉO REMOVER)

- *"Protocolo organiza o cuidado."*
- *"Hist√≥rico orienta, n√£o garante."*
- *"Margem protege a cl√≠nica."*
- *"O sistema informa, o humano decide."*
- *"Este m√≥dulo existe para transformar experi√™ncia em m√©todo."*
- *"Protocolo s√≥ cumpre o papel se for r√°pido de preencher."*

---

## CRIT√âRIO DE QUALIDADE

Este m√≥dulo est√° correto se:

- melhora decis√£o cl√≠nica
- reduz improviso
- protege margem
- evita promo√ß√µes irrespons√°veis
- mant√©m √©tica e clareza
